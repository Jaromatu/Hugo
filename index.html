<!DOCTYPE html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <title>Commit do GitHuba</title>
  </head>
  <body>
    <h1>Commit do GitHuba z przeglƒÖdarki</h1>
    <textarea id="content" rows="10" cols="50">
Tutaj wpisz zawarto≈õƒá pliku</textarea
    ><br />
    <button onclick="commitToGitHub()">Wy≈õlij commit</button>

    <script>
      const token = "ghp_TW√ìJ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_TOKEN"; // Wklej tutaj sw√≥j token
      const owner = "Jaromatu";
      const repo = "projekt";
      const path = "plik.txt"; // ≈õcie≈ºka pliku w repo
      const branch = "main"; // lub inna ga≈ÇƒÖ≈∫

      async function commitToGitHub() {
        const content = document.getElementById("content").value;
        const base64Content = btoa(unescape(encodeURIComponent(content))); // konwersja do base64

        // najpierw pobieramy SHA istniejƒÖcego pliku (je≈õli istnieje)
        let sha = null;
        try {
          const res = await fetch(
            `https://api.github.com/repos/${owner}/${repo}/contents/${path}?ref=${branch}`,
            {
              headers: {
                Authorization: `Bearer ${token}`,
                Accept: "application/vnd.github+json",
              },
            }
          );
          if (res.ok) {
            const data = await res.json();
            sha = data.sha;
          }
        } catch (e) {
          console.error("B≈ÇƒÖd przy pobieraniu SHA:", e);
        }

        const payload = {
          message: "Commit z przeglƒÖdarki ‚ú®",
          content: base64Content,
          branch: branch,
        };
        if (sha) payload.sha = sha;

        const result = await fetch(
          `https://api.github.com/repos/${owner}/${repo}/contents/${path}`,
          {
            method: "PUT",
            headers: {
              Authorization: `Bearer ${token}`,
              Accept: "application/vnd.github+json",
            },
            body: JSON.stringify(payload),
          }
        );

        const responseData = await result.json();
        if (result.ok) {
          alert("‚úÖ Commit wykonany! Zobacz repo üòÑ");
          console.log(responseData);
        } else {
          alert("‚ùå Co≈õ posz≈Ço nie tak...");
          console.error(responseData);
        }
      }
    </script>
  </body>
</html>
